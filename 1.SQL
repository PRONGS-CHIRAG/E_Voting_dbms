DROP DATABASE E_VOTING;
CREATE DATABASE E_VOTING;
\c e_voting

CREATE TABLE PARTY
(
	P_ID VARCHAR(4) PRIMARY KEY,
    P_NAME VARCHAR(20),
    P_SYMBOL VARCHAR(20)
);

CREATE TABLE ADMN
(
    AD_ID VARCHAR(5) PRIMARY KEY,
    AD_PWD VARCHAR(20)
);

CREATE TABLE CONSTITUENCY
(
    CON_ID VARCHAR(6) PRIMARY KEY,
    CON_NAME VARCHAR(20),
    CITY VARCHAR(30),
    STAT VARCHAR(20),
    AD_ID VARCHAR(5),
    FOREIGN KEY(AD_ID) REFERENCES ADMN(AD_ID) ON UPDATE CASCADE
);

CREATE TABLE CONTESTOR
(
    C_ID VARCHAR(12) PRIMARY KEY,
    AD_ID VARCHAR(5),
    CON_ID VARCHAR(6),
    FOREIGN KEY(AD_ID) REFERENCES ADMN(AD_ID) ON UPDATE CASCADE,
    FOREIGN KEY(CON_ID) REFERENCES CONSTITUENCY(CON_ID) ON DELETE CASCADE
);

CREATE TABLE VOTER_INFO
(
    V_ID VARCHAR(12) PRIMARY KEY,
    V_NAME VARCHAR(30),
    AADHAR VARCHAR(12),
    DOB DATE,
    GENDER CHAR(6),
    ADDRESS VARCHAR(100),
    CON_ID VARCHAR(6),
    AD_ID VARCHAR(5),
    FOREIGN KEY(CON_ID) REFERENCES CONSTITUENCY(CON_ID) ON DELETE CASCADE,
    FOREIGN KEY(AD_ID) REFERENCES ADMN(AD_ID) ON UPDATE CASCADE
);

CREATE TABLE NOMINEE
(
    NOM_FEE INT,
    NOM_DATE DATE,
    ELIGIBLE INT,
    AD_ID VARCHAR(5),
    P_ID VARCHAR(4),
    V_ID VARCHAR(12),
    CON_ID VARCHAR(6),
    PRIMARY KEY (AD_ID, P_ID, V_ID),
    FOREIGN KEY(CON_ID) REFERENCES CONSTITUENCY(CON_ID) ON DELETE CASCADE
);

CREATE TABLE REPRESENTATIVE
(
    NO_OF_VOTES INT,
    C_ID VARCHAR(12),
    CON_ID VARCHAR(6),
    FOREIGN KEY(C_ID) REFERENCES CONTESTOR(C_ID) ON DELETE CASCADE,
    FOREIGN KEY(CON_ID) REFERENCES CONSTITUENCY(CON_ID) ON DELETE CASCADE
);

CREATE TABLE VOTES
(
    V_ID VARCHAR(12),
    C_ID VARCHAR(12),
    PRIMARY KEY (V_ID, C_ID),
    FOREIGN KEY(V_ID) REFERENCES VOTER_INFO(V_ID) ON DELETE CASCADE,
    FOREIGN KEY(C_ID) REFERENCES CONTESTOR(C_ID) ON DELETE CASCADE
);

CREATE TABLE NOM_CON
(
    AD_ID VARCHAR(5),
    P_ID VARCHAR(4),
    V_ID VARCHAR(12),
    C_ID VARCHAR(12),
    PRIMARY KEY (AD_ID,P_ID,V_ID,C_ID),
    FOREIGN KEY(AD_ID) REFERENCES ADMN(AD_ID) ON DELETE CASCADE,
    FOREIGN KEY(P_ID ) REFERENCES PARTY(P_ID) ON DELETE CASCADE,
    FOREIGN KEY(V_ID) REFERENCES VOTER_INFO(V_ID) ON DELETE CASCADE,
    FOREIGN KEY(C_ID) REFERENCES CONTESTOR(C_ID) ON DELETE CASCADE
);

    